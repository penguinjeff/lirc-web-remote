<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
<script src="js/0utils.js?0"></script>
	<script>
var preinit=true;
var prev=0;
var devices_loaded=false;
var activities_loaded=false;
function nav(init='')
{const navigator=document.getElementById("navigator");
 if(preinit)
 {
  preinit=false;
 }
 else if(init)
 {
  navigator.selectedIndex=init;
  navigator.dispatchEvent(new Event('change'));
 }
 else if(navigator.value=='refresh')
 {navigator.selectedIndex=prev;
  navigator.dispatchEvent(new Event('change'));
 }
 else
 {prev=navigator.selectedIndex;
  alert(navigator.value);
 }
}

var activities_list=['None'];
var devices_list=['None'];
var remotes={};
var activities={};

function refresh()
{
 devices_loaded=false;
 activities_loaded=false;
 preinit=true;
 var rev=Date.now();

 fetch('remotes/remotes.js?rev='+rev)
  .then(response => response.json()) // Parses the response body as JSON
  .then(data => {
    console.log(data); // Work with your JSON data (now a JavaScript object);
    devices_loaded=true;
    if(data['remotes']){remotes=data['remotes'];}
    create_navigator();
  })
  .catch(error => {
    console.error('Error fetching JSON:', error); // Handle any errors
    devices_loaded=true;
    create_navigator();
  });
 fetch('activities/activities.js?rev='+rev)
  .then(response => response.json()) // Parses the response body as JSON
  .then(data => {
    console.log(data); // Work with your JSON data (now a JavaScript object)
    activities_loaded=true;
    if(data['activites']){remotes=data['activities'];}
    create_navigator();
  })
  .catch(error => {
    console.error('Error fetching JSON:', error); // Handle any errors
    activities_loaded=true;
    create_navigator();
  });
}

function update_lists()
{
 devices_list=Object.keys(remotes);
 if(devices_list.length===0){devices_list=['None'];}
 activities_list=Object.keys(activities);
 if(activities_list.length===0){activities_list=['None'];}
 console.log(devices_list);
 console.log(activities_list);
} 

function create_navigator()
{
 if(!devices_loaded||!activities_loaded){return}
 update_lists();
 var navigator=document.getElementById("navigator");
 var edits=['Activites','Macros','Modules','Displays'];
 var navigate={'select':{'Activities':activities_list,'Devices':devices_list,'Edit':edits,'refresh':true},id:'navigator',onchange:'nav()'};
 var elem=createElement(navigate);
 if(navigator){navigator.remove};
 navigator_location.appendChild(elem);
 nav(prev);
}

var navigator_location=createElement({'tag':'div'});
window.addEventListener('load', function () {
 var bodyElement = document.body;
 bodyElement.appendChild(navigator_location);
 refresh()
})

	</script>
</head>
<body>
</body>
</html>
