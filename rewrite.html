<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
<script src="js/0utils.js"></script>
<script id="remotes" src="data/get_remotes.js"></script>
<script id="displays" src="data/get_displays.js"></script>
<script id="default_display" src="data/get_default_display.js"></script>
<script id="activities" src="data/get_activities.js"></script>
<script id="macros" src="data/get_macros.js"></script>
<script id="modules" src="data/get_modules.js"></script>
<script id="default_modules" src="data/get_default_modules.js"></script>
<script src="js/save_load_refresh.js"></script>
<script>
var remotes={};
var default_display=get_default_display();
var displays={};
var activites={};
var macros={};
var modules={};
var default_modules=get_default_modules;

function edit(item)
{
 console.log('edit');
 console.log(item);
}

function activity_display(activity)
{
 const {remotes,display}=activity;
 console.log('display');
 console.log(remotes);
 console.log(display);
}

function display(item,subitem)
{
 console.log("item");
 console.log(item);
 if(subitem=='None'){return}
 console.log("subitem");
 console.log(subitem);
 let activity={};
 switch(item)
 {case 'Remotes':
  activity={remotes:[subitem],display:default_display};
  break;
  case 'Activities':
  activitiy=activities[subitem];
  break;
  case 'Edit':
   edit(subitem);
   return;
  break;
  default:
  console.log(item+' not known');
 } 
 activity_display(activity);
}



var remotes_list=['None'];
var displays_list=['None'];
var activities_list=['None'];
var macros_list=['None'];
var modules_list=['None'];

var prev=-1;
var prevsub=-1
const protocol = window.location.protocol;
//console.log(protocol);
var menu='';
var submenu='';

const url = new URL(window.location.href);
menu = url.searchParams.get('menu');
submenu = url.searchParams.get('submenu');
ts = url.searchParams.get('ts');
console.log('menu:'+menu);
console.log('submenu:'+submenu);

function setoption(selectbox,requested_option_name)
{let index=Array.from(selectbox.options).map(option => option.value).indexOf(requested_option_name);
 if(index===-1){return;}
 selectbox.selectedIndex=index;
 selectbox.dispatchEvent(new Event('change'));
}

var count=0;
var preinit=true;
var menu_set=false;
var submenu_set=false;
function nav()
{
 console.log("count:"+(count++));
 if(preinit){preinit=false;console.log("Preinit");return;}
 const navigator=document.getElementById("navigator");
 if(!menu_set)
 {
//  console.log("initializing menu");
  menu_set=true;
  if(menu){setoption(navigator,menu);}
  else
  {
   if(Object.keys(activities).length === 0){setoption(navigator,'Remotes');}
   else{setoption(navigator,'Activities');}
  }
  return;
 }
 const item=navigator.nextElementSibling;
 if(!submenu_set)
 {
//  console.log("initializing submenu");
  submenu_set=true;
  if(submenu){setoption(navigator.nextElementSibling,submenu);}
  else{setoption(navigator.nextElementSibling,Array.from(item.options).map(option => option.value)[0]);}
  return;
 }
 if(navigator.value=='refresh')
 {
//  console.log("refresh");
  menu_set=false;
  submenu_set=false;
  menu=prev;
  submenu=prevsub;
  setoption(navigator,menu);
  return;
 }
 prev=navigator.value
 prevsub=item.value;
 display(prev,prevsub);
}


function refresh()
{
 load();
 refresh_list('remotes');
 refresh_list('displays');
 refresh_list('activities');
 refresh_list('macros');
 refresh_list('modules');
 create_navigator();
}

function refresh_list(item)
{window[item+'_list']=Object.keys(window[item]);
if(window[item+'_list'].length===0){window[item+'_list']=['None'];}
}

function create_navigator()
{
 let navigator=document.getElementById("navigator");
 if(navigator){navigator.remove};
 let edits=['Activites','Macros','Modules','Displays'];
 let navigate={'select':{'Activities':activities_list,'Remotes':remotes_list,'Edit':edits,'refresh':['None']},id:'navigator',onchange:'nav()'};
 let elem=createElement(navigate);
 navigator_location.appendChild(elem);
 nav();
}

var navigator_location=createElement({'tag':'div'});
window.addEventListener('load', function () {
 var bodyElement = document.body;
 bodyElement.appendChild(navigator_location);
 refresh()
})

	</script>
</head>
<body>
</body>
</html>
